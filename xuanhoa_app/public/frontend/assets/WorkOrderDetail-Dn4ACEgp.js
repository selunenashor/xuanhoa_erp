import{r as c,o as S,c as a,a as e,b as j,w as M,e as T,t as o,i as h,q,s as B,F as b,l as N,j as O,v as P,y as L,x as g,k as I,f as l}from"./index-D7PpSP6X.js";const W={class:"min-h-screen bg-gray-100"},V={class:"bg-xh-red text-white shadow-lg"},z={class:"container mx-auto px-4 py-4 flex items-center"},D={class:"text-xl font-bold"},E={class:"container mx-auto px-4 py-6"},F={key:0,class:"text-center py-8 text-gray-500"},H={key:1,class:"space-y-6"},K={class:"bg-white rounded-lg shadow p-6"},R={class:"flex justify-between items-center mb-4"},$={class:"mb-4"},A={class:"flex justify-between text-sm text-gray-600 mb-1"},Q={class:"h-4 bg-gray-200 rounded-full overflow-hidden"},U={class:"bg-white rounded-lg shadow p-6"},G={class:"space-y-3"},J={class:"flex justify-between"},X={class:"font-medium"},Y={class:"flex justify-between"},Z={class:"font-medium"},ee={class:"flex justify-between"},te={class:"font-medium"},se={class:"flex justify-between"},oe={class:"font-medium"},ne={key:0,class:"bg-white rounded-lg shadow p-6"},ae={class:"text-lg font-bold text-xh-black mb-4"},le={key:0,class:"space-y-2"},re={class:"font-medium text-sm"},de={class:"text-xs text-gray-500"},ie={class:"text-right"},ue={class:"font-medium"},ce={class:"text-xs text-gray-500"},he={class:"space-y-3"},ve=["disabled"],ge={class:"bg-white rounded-lg shadow p-4"},me=["max"],xe=["disabled"],pe={key:2,class:"bg-green-50 border border-green-200 rounded-lg p-4 text-center"},be={key:2,class:"fixed bottom-4 left-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg text-center"},_e={key:3,class:"fixed bottom-4 left-4 right-4 bg-red-500 text-white px-4 py-3 rounded-lg shadow-lg text-center"},we={__name:"WorkOrderDetail",setup(ye){const _=L();I();const s=c({}),m=c([]),x=c(!0),d=c(!1),i=c(null),v=c(""),r=c(""),p=async()=>{x.value=!0;try{const n=_.params.name;s.value=await g.getWorkOrder(n),s.value.bom_no&&(m.value=await g.getBOMItems(s.value.bom_no))}catch(n){console.error("Error loading work order:",n),r.value="Không thể tải thông tin lệnh sản xuất"}finally{x.value=!1}},y=async()=>{d.value=!0,r.value="";try{await g.startWorkOrder(s.value.name),v.value="Đã bắt đầu sản xuất!",setTimeout(()=>{v.value="",p()},2e3)}catch(n){r.value=n.message||"Lỗi khi bắt đầu sản xuất",setTimeout(()=>r.value="",3e3)}finally{d.value=!1}},f=async()=>{if(i.value){d.value=!0,r.value="";try{await g.completeWorkOrder(s.value.name,i.value),v.value=`Đã hoàn thành ${i.value} sản phẩm!`,setTimeout(()=>{v.value="",i.value=null,p()},2e3)}catch(n){r.value=n.message||"Lỗi khi hoàn thành sản xuất",setTimeout(()=>r.value="",3e3)}finally{d.value=!1}}},w=n=>({"Not Started":"bg-gray-100 text-gray-600","In Process":"bg-xh-gold bg-opacity-20 text-yellow-700",Completed:"bg-green-100 text-green-600",Stopped:"bg-red-100 text-red-600"})[n]||"bg-gray-100 text-gray-600",k=n=>({"Not Started":"Chờ sản xuất","In Process":"Đang sản xuất",Completed:"Hoàn thành",Stopped:"Đã dừng"})[n]||n;return S(()=>p()),(n,t)=>{const C=T("router-link");return l(),a("div",W,[e("header",V,[e("div",z,[j(C,{to:"/production/orders",class:"mr-4"},{default:M(()=>[...t[1]||(t[1]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1}),e("div",null,[t[2]||(t[2]=e("div",{class:"text-sm opacity-75"},"Chi tiết lệnh sản xuất",-1)),e("h1",D,o(s.value.name),1)])])]),e("main",E,[x.value?(l(),a("div",F," Đang tải... ")):(l(),a("div",H,[e("div",K,[e("div",R,[t[3]||(t[3]=e("h2",{class:"text-lg font-bold text-xh-black"},"Trạng thái",-1)),e("span",{class:q([w(s.value.status),"px-3 py-1 rounded-full text-sm font-medium"])},o(k(s.value.status)),3)]),e("div",$,[e("div",A,[t[4]||(t[4]=e("span",null,"Tiến độ",-1)),e("span",null,o(s.value.produced_qty)+" / "+o(s.value.qty)+" sản phẩm",1)]),e("div",Q,[e("div",{class:"h-full bg-xh-gold transition-all duration-300",style:B({width:`${s.value.progress}%`})},null,4)])])]),e("div",U,[t[9]||(t[9]=e("h2",{class:"text-lg font-bold text-xh-black mb-4"},"Thông tin sản phẩm",-1)),e("div",G,[e("div",J,[t[5]||(t[5]=e("span",{class:"text-gray-600"},"Mã SP",-1)),e("span",X,o(s.value.production_item),1)]),e("div",Y,[t[6]||(t[6]=e("span",{class:"text-gray-600"},"Tên SP",-1)),e("span",Z,o(s.value.item_name),1)]),e("div",ee,[t[7]||(t[7]=e("span",{class:"text-gray-600"},"SL yêu cầu",-1)),e("span",te,o(s.value.qty),1)]),e("div",se,[t[8]||(t[8]=e("span",{class:"text-gray-600"},"Kho thành phẩm",-1)),e("span",oe,o(s.value.fg_warehouse),1)])])]),s.value.bom_no?(l(),a("div",ne,[e("h2",ae,"BOM: "+o(s.value.bom_no),1),m.value.length>0?(l(),a("div",le,[(l(!0),a(b,null,N(m.value,u=>(l(),a("div",{key:u.item_code,class:"flex justify-between items-center py-2 border-b border-gray-100 last:border-0"},[e("div",null,[e("div",re,o(u.item_name),1),e("div",de,o(u.item_code),1)]),e("div",ie,[e("div",ue,o(u.qty_required),1),e("div",ce,o(u.uom),1)])]))),128))])):h("",!0)])):h("",!0),e("div",he,[s.value.status==="Not Started"?(l(),a("button",{key:0,onClick:y,disabled:d.value,class:"w-full bg-xh-gold text-xh-black font-bold py-4 rounded-lg shadow hover:bg-opacity-90 transition disabled:opacity-50"},o(d.value?"Đang xử lý...":"Bắt đầu sản xuất"),9,ve)):h("",!0),s.value.status==="In Process"?(l(),a(b,{key:1},[e("div",ge,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Số lượng hoàn thành ",-1)),O(e("input",{"onUpdate:modelValue":t[0]||(t[0]=u=>i.value=u),type:"number",min:"1",max:s.value.qty-s.value.produced_qty,class:"w-full border border-gray-300 rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-xh-red",placeholder:"Nhập số lượng"},null,8,me),[[P,i.value,void 0,{number:!0}]])]),e("button",{onClick:f,disabled:d.value||!i.value,class:"w-full bg-green-600 text-white font-bold py-4 rounded-lg shadow hover:bg-green-700 transition disabled:opacity-50"},o(d.value?"Đang xử lý...":"Hoàn thành sản xuất"),9,xe)],64)):h("",!0),s.value.status==="Completed"?(l(),a("div",pe,[...t[11]||(t[11]=[e("svg",{class:"w-12 h-12 text-green-500 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("div",{class:"text-green-700 font-medium"},"Lệnh sản xuất đã hoàn thành",-1)])])):h("",!0)])])),v.value?(l(),a("div",be,o(v.value),1)):h("",!0),r.value?(l(),a("div",_e,o(r.value),1)):h("",!0)])])}}};export{we as default};
