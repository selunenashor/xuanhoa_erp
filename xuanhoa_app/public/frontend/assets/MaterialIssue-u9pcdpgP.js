import{g as M,r as d,o as S,x as p,n as V,c as r,a as e,b as N,w as T,e as B,h as E,i as m,j as y,v as b,F as f,l as k,t as u,m as U,f as n}from"./index-D7PpSP6X.js";const j={class:"min-h-screen bg-gray-100"},D={class:"bg-xh-red text-white shadow-lg"},F={class:"container mx-auto px-4 py-4 flex items-center"},X={class:"container mx-auto px-4 py-6"},A={class:"bg-white rounded-lg shadow p-6"},K={key:0,class:"mt-2 border rounded-lg divide-y"},L=["onClick"],P={class:"font-medium"},R={class:"text-sm text-gray-500"},W={key:0,class:"bg-gray-50 rounded-lg p-4"},$={class:"font-medium"},z={class:"text-sm text-gray-500"},G={key:0,class:"mt-2 pt-2 border-t"},H={class:"text-sm font-medium text-green-600"},J=["value"],O={key:1,class:"bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg"},Q={key:2,class:"bg-green-50 border border-green-200 text-green-600 px-4 py-3 rounded-lg"},Y=["disabled"],Z={key:0},ee={key:1},le={__name:"MaterialIssue",setup(te){const l=M({item_code:"",qty:null,warehouse:""}),v=d(!1),i=d(""),g=d(""),c=d([]),a=d(null),h=d(null),_=d([]);S(async()=>{try{_.value=await p.getWarehouses(0)}catch(s){console.error("Error loading warehouses:",s)}}),V(a,async s=>{if(s)try{h.value=await p.getItemStock(s.item_code)}catch(t){console.error("Error getting stock:",t)}else h.value=null});let x=null;const w=()=>{if(a.value=null,clearTimeout(x),l.item_code.length<2){c.value=[];return}x=setTimeout(async()=>{try{c.value=await p.searchItems(l.item_code)}catch(s){console.error("Search error:",s)}},300)},I=s=>{a.value=s,l.item_code=s.item_code,c.value=[]},q=async()=>{i.value="",g.value="",v.value=!0;try{const s=await p.createMaterialIssue(l.item_code,l.qty,l.warehouse);s.success?(g.value=s.message,l.item_code="",l.qty=null,a.value=null):i.value=s.message}catch(s){i.value=s.message||"Có lỗi xảy ra"}finally{v.value=!1}};return(s,t)=>{const C=B("router-link");return n(),r("div",j,[e("header",D,[e("div",F,[N(C,{to:"/",class:"mr-4"},{default:T(()=>[...t[3]||(t[3]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1}),t[4]||(t[4]=e("h1",{class:"text-xl font-bold"},"Xuất kho",-1))])]),e("main",X,[e("div",A,[e("form",{onSubmit:E(q,["prevent"]),class:"space-y-6"},[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Mã hàng hóa *",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>l.item_code=o),type:"text",required:"",onInput:w,class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-xh-red",placeholder:"Nhập mã hoặc tên hàng..."},null,544),[[b,l.item_code]]),c.value.length>0?(n(),r("div",K,[(n(!0),r(f,null,k(c.value,o=>(n(),r("div",{key:o.item_code,onClick:se=>I(o),class:"px-4 py-3 hover:bg-gray-50 cursor-pointer"},[e("div",P,u(o.item_code),1),e("div",R,u(o.item_name),1)],8,L))),128))])):m("",!0)]),a.value?(n(),r("div",W,[t[6]||(t[6]=e("div",{class:"text-sm text-gray-500"},"Đã chọn:",-1)),e("div",$,u(a.value.item_code)+" - "+u(a.value.item_name),1),e("div",z,"Đơn vị: "+u(a.value.stock_uom),1),h.value?(n(),r("div",G,[e("div",H,"Tồn kho: "+u(h.value.total_qty)+" "+u(a.value.stock_uom),1)])):m("",!0)])):m("",!0),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Số lượng xuất *",-1)),y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.qty=o),type:"number",min:"0.01",step:"0.01",required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-xh-red",placeholder:"Nhập số lượng"},null,512),[[b,l.qty,void 0,{number:!0}]])]),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Kho xuất *",-1)),y(e("select",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.warehouse=o),required:"",class:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-xh-red"},[t[8]||(t[8]=e("option",{value:""},"-- Chọn kho --",-1)),(n(!0),r(f,null,k(_.value,o=>(n(),r("option",{key:o.name,value:o.name},u(o.warehouse_name||o.name),9,J))),128))],512),[[U,l.warehouse]])]),i.value?(n(),r("div",O,u(i.value),1)):m("",!0),g.value?(n(),r("div",Q,u(g.value),1)):m("",!0),e("button",{type:"submit",disabled:v.value||!a.value,class:"w-full bg-xh-red text-white py-4 rounded-lg font-medium text-lg hover:bg-red-700 transition disabled:opacity-50"},[v.value?(n(),r("span",Z,"Đang xử lý...")):(n(),r("span",ee,"Xuất kho"))],8,Y)],32)])])])}}};export{le as default};
